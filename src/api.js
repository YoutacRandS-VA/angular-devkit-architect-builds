"use strict";
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.scheduleTargetAndForget = exports.targetFromTargetString = exports.targetStringFromTarget = exports.fromAsyncIterable = exports.isBuilderOutput = exports.BuilderProgressState = void 0;
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const progress_schema_1 = require("./progress-schema");
Object.defineProperty(exports, "BuilderProgressState", { enumerable: true, get: function () { return progress_schema_1.State; } });
// eslint-disable-next-line @typescript-eslint/no-explicit-any
function isBuilderOutput(obj) {
    if (!obj || typeof obj.then === 'function' || typeof obj.subscribe === 'function') {
        return false;
    }
    if (typeof obj[Symbol.asyncIterator] === 'function') {
        return false;
    }
    return typeof obj.success === 'boolean';
}
exports.isBuilderOutput = isBuilderOutput;
function fromAsyncIterable(iterable) {
    return new rxjs_1.Observable((subscriber) => {
        handleAsyncIterator(subscriber, iterable[Symbol.asyncIterator]()).then(() => subscriber.complete(), (error) => subscriber.error(error));
    });
}
exports.fromAsyncIterable = fromAsyncIterable;
async function handleAsyncIterator(subscriber, iterator) {
    var _a;
    const teardown = new Promise((resolve) => subscriber.add(() => resolve()));
    try {
        while (!subscriber.closed) {
            const result = await Promise.race([teardown, iterator.next()]);
            if (!result || result.done) {
                break;
            }
            subscriber.next(result.value);
        }
    }
    finally {
        await ((_a = iterator.return) === null || _a === void 0 ? void 0 : _a.call(iterator));
    }
}
/**
 * Returns a string of "project:target[:configuration]" for the target object.
 */
function targetStringFromTarget({ project, target, configuration }) {
    return `${project}:${target}${configuration !== undefined ? ':' + configuration : ''}`;
}
exports.targetStringFromTarget = targetStringFromTarget;
/**
 * Return a Target tuple from a string.
 */
function targetFromTargetString(str) {
    const tuple = str.split(/:/, 3);
    if (tuple.length < 2) {
        throw new Error('Invalid target string: ' + JSON.stringify(str));
    }
    return {
        project: tuple[0],
        target: tuple[1],
        ...(tuple[2] !== undefined && { configuration: tuple[2] }),
    };
}
exports.targetFromTargetString = targetFromTargetString;
/**
 * Schedule a target, and forget about its run. This will return an observable of outputs, that
 * as a a teardown will stop the target from running. This means that the Run object this returns
 * should not be shared.
 *
 * The reason this is not part of the Context interface is to keep the Context as normal form as
 * possible. This is really an utility that people would implement in their project.
 *
 * @param context The context of your current execution.
 * @param target The target to schedule.
 * @param overrides Overrides that are used in the target.
 * @param scheduleOptions Additional scheduling options.
 */
function scheduleTargetAndForget(context, target, overrides, scheduleOptions) {
    let resolve = null;
    const promise = new Promise((r) => (resolve = r));
    context.addTeardown(() => promise);
    return (0, rxjs_1.from)(context.scheduleTarget(target, overrides, scheduleOptions)).pipe((0, operators_1.switchMap)((run) => new rxjs_1.Observable((observer) => {
        const subscription = run.output.subscribe(observer);
        return () => {
            subscription.unsubscribe();
            // We can properly ignore the floating promise as it's a "reverse" promise; the teardown
            // is waiting for the resolve.
            // eslint-disable-next-line @typescript-eslint/no-floating-promises
            run.stop().then(resolve);
        };
    })));
}
exports.scheduleTargetAndForget = scheduleTargetAndForget;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvYW5ndWxhcl9kZXZraXQvYXJjaGl0ZWN0L3NyYy9hcGkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7R0FNRzs7O0FBR0gsK0JBQTJFO0FBQzNFLDhDQUEyQztBQUczQyx1REFBaUc7QUFHeEYscUdBSFMsdUJBQW9CLE9BR1Q7QUF3UDdCLDhEQUE4RDtBQUM5RCxTQUFnQixlQUFlLENBQUMsR0FBUTtJQUN0QyxJQUFJLENBQUMsR0FBRyxJQUFJLE9BQU8sR0FBRyxDQUFDLElBQUksS0FBSyxVQUFVLElBQUksT0FBTyxHQUFHLENBQUMsU0FBUyxLQUFLLFVBQVUsRUFBRTtRQUNqRixPQUFPLEtBQUssQ0FBQztLQUNkO0lBRUQsSUFBSSxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLEtBQUssVUFBVSxFQUFFO1FBQ25ELE9BQU8sS0FBSyxDQUFDO0tBQ2Q7SUFFRCxPQUFPLE9BQU8sR0FBRyxDQUFDLE9BQU8sS0FBSyxTQUFTLENBQUM7QUFDMUMsQ0FBQztBQVZELDBDQVVDO0FBRUQsU0FBZ0IsaUJBQWlCLENBQUksUUFBMEI7SUFDN0QsT0FBTyxJQUFJLGlCQUFVLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRTtRQUNuQyxtQkFBbUIsQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUNwRSxHQUFHLEVBQUUsQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLEVBQzNCLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUNuQyxDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBUEQsOENBT0M7QUFFRCxLQUFLLFVBQVUsbUJBQW1CLENBQ2hDLFVBQXlCLEVBQ3pCLFFBQTBCOztJQUUxQixNQUFNLFFBQVEsR0FBRyxJQUFJLE9BQU8sQ0FBTyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFFakYsSUFBSTtRQUNGLE9BQU8sQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFO1lBQ3pCLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQy9ELElBQUksQ0FBQyxNQUFNLElBQUksTUFBTSxDQUFDLElBQUksRUFBRTtnQkFDMUIsTUFBTTthQUNQO1lBRUQsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDL0I7S0FDRjtZQUFTO1FBQ1IsTUFBTSxDQUFBLE1BQUEsUUFBUSxDQUFDLE1BQU0sd0RBQUksQ0FBQSxDQUFDO0tBQzNCO0FBQ0gsQ0FBQztBQTJCRDs7R0FFRztBQUNILFNBQWdCLHNCQUFzQixDQUFDLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQVU7SUFDL0UsT0FBTyxHQUFHLE9BQU8sSUFBSSxNQUFNLEdBQUcsYUFBYSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLGFBQWEsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDekYsQ0FBQztBQUZELHdEQUVDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixzQkFBc0IsQ0FBQyxHQUFXO0lBQ2hELE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ2hDLElBQUksS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7UUFDcEIsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7S0FDbEU7SUFFRCxPQUFPO1FBQ0wsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDakIsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDaEIsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxTQUFTLElBQUksRUFBRSxhQUFhLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7S0FDM0QsQ0FBQztBQUNKLENBQUM7QUFYRCx3REFXQztBQUVEOzs7Ozs7Ozs7Ozs7R0FZRztBQUNILFNBQWdCLHVCQUF1QixDQUNyQyxPQUF1QixFQUN2QixNQUFjLEVBQ2QsU0FBMkIsRUFDM0IsZUFBaUM7SUFFakMsSUFBSSxPQUFPLEdBQXdCLElBQUksQ0FBQztJQUN4QyxNQUFNLE9BQU8sR0FBRyxJQUFJLE9BQU8sQ0FBTyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN4RCxPQUFPLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBRW5DLE9BQU8sSUFBQSxXQUFJLEVBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLGVBQWUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUMxRSxJQUFBLHFCQUFTLEVBQ1AsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUNOLElBQUksaUJBQVUsQ0FBZ0IsQ0FBQyxRQUFRLEVBQUUsRUFBRTtRQUN6QyxNQUFNLFlBQVksR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUVwRCxPQUFPLEdBQUcsRUFBRTtZQUNWLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUMzQix3RkFBd0Y7WUFDeEYsOEJBQThCO1lBQzlCLG1FQUFtRTtZQUNuRSxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzNCLENBQUMsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUNMLENBQ0YsQ0FBQztBQUNKLENBQUM7QUExQkQsMERBMEJDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEdvb2dsZSBMTEMgQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL2FuZ3VsYXIuaW8vbGljZW5zZVxuICovXG5cbmltcG9ydCB7IGFuYWx5dGljcywgZXhwZXJpbWVudGFsLCBqc29uLCBsb2dnaW5nIH0gZnJvbSAnQGFuZ3VsYXItZGV2a2l0L2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3Vic2NyaWJhYmxlT3JQcm9taXNlLCBTdWJzY3JpYmVyLCBmcm9tIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBTY2hlbWEgYXMgUmVhbEJ1aWxkZXJJbnB1dCwgVGFyZ2V0IGFzIFJlYWxUYXJnZXQgfSBmcm9tICcuL2lucHV0LXNjaGVtYSc7XG5pbXBvcnQgeyBTY2hlbWEgYXMgUmVhbEJ1aWxkZXJPdXRwdXQgfSBmcm9tICcuL291dHB1dC1zY2hlbWEnO1xuaW1wb3J0IHsgU3RhdGUgYXMgQnVpbGRlclByb2dyZXNzU3RhdGUsIFNjaGVtYSBhcyBSZWFsQnVpbGRlclByb2dyZXNzIH0gZnJvbSAnLi9wcm9ncmVzcy1zY2hlbWEnO1xuXG5leHBvcnQgdHlwZSBUYXJnZXQgPSBqc29uLkpzb25PYmplY3QgJiBSZWFsVGFyZ2V0O1xuZXhwb3J0IHsgQnVpbGRlclByb2dyZXNzU3RhdGUgfTtcblxuLy8gVHlwZSBzaG9ydCBoYW5kcy5cbmV4cG9ydCB0eXBlIEJ1aWxkZXJSZWdpc3RyeSA9IGV4cGVyaW1lbnRhbC5qb2JzLlJlZ2lzdHJ5PFxuICBqc29uLkpzb25PYmplY3QsXG4gIEJ1aWxkZXJJbnB1dCxcbiAgQnVpbGRlck91dHB1dFxuPjtcblxuLyoqXG4gKiBBbiBBUEkgdHlwZWQgQnVpbGRlclByb2dyZXNzLiBUaGUgaW50ZXJmYWNlIGdlbmVyYXRlZCBmcm9tIHRoZSBzY2hlbWEgaXMgdG9vIHBlcm1pc3NpdmUsXG4gKiBzbyB0aGlzIEFQSSBpcyB0aGUgb25lIHdlIHNob3cgaW4gb3VyIEFQSS4gUGxlYXNlIG5vdGUgdGhhdCBub3QgYWxsIGZpZWxkcyBhcmUgaW4gdGhlcmU7IHRoaXNcbiAqIGlzIGluIGFkZGl0aW9uIHRvIGZpZWxkcyBpbiB0aGUgc2NoZW1hLlxuICovXG5leHBvcnQgdHlwZSBUeXBlZEJ1aWxkZXJQcm9ncmVzcyA9XG4gIHwgeyBzdGF0ZTogQnVpbGRlclByb2dyZXNzU3RhdGUuU3RvcHBlZCB9XG4gIHwgeyBzdGF0ZTogQnVpbGRlclByb2dyZXNzU3RhdGUuRXJyb3I7IGVycm9yOiBqc29uLkpzb25WYWx1ZSB9XG4gIHwgeyBzdGF0ZTogQnVpbGRlclByb2dyZXNzU3RhdGUuV2FpdGluZzsgc3RhdHVzPzogc3RyaW5nIH1cbiAgfCB7IHN0YXRlOiBCdWlsZGVyUHJvZ3Jlc3NTdGF0ZS5SdW5uaW5nOyBzdGF0dXM/OiBzdHJpbmc7IGN1cnJlbnQ6IG51bWJlcjsgdG90YWw/OiBudW1iZXIgfTtcblxuLyoqXG4gKiBEZWNsYXJhdGlvbiBvZiB0aG9zZSB0eXBlcyBhcyBKc29uT2JqZWN0IGNvbXBhdGlibGUuIEpzb25PYmplY3QgaXMgbm90IGNvbXBhdGlibGUgd2l0aFxuICogb3B0aW9uYWwgbWVtYmVycywgc28gdGhvc2Ugd291bGRuJ3QgYmUgZGlyZWN0bHkgYXNzaWduYWJsZSB0byBvdXIgaW50ZXJuYWwgSnNvbiB0eXBpbmdzLlxuICogRm9yY2luZyB0aGUgdHlwZSB0byBiZSBib3RoIGEgSnNvbk9iamVjdCBhbmQgdGhlIHR5cGUgZnJvbSB0aGUgU2NoZW1hIHRlbGxzIFR5cGVzY3JpcHQgdGhleVxuICogYXJlIGNvbXBhdGlibGUgKHdoaWNoIHRoZXkgYXJlKS5cbiAqIFRoZXNlIHR5cGVzIHNob3VsZCBiZSB1c2VkIGV2ZXJ5d2hlcmUuXG4gKi9cbmV4cG9ydCB0eXBlIEJ1aWxkZXJJbnB1dCA9IGpzb24uSnNvbk9iamVjdCAmIFJlYWxCdWlsZGVySW5wdXQ7XG5leHBvcnQgdHlwZSBCdWlsZGVyT3V0cHV0ID0ganNvbi5Kc29uT2JqZWN0ICYgUmVhbEJ1aWxkZXJPdXRwdXQ7XG5leHBvcnQgdHlwZSBCdWlsZGVyUHJvZ3Jlc3MgPSBqc29uLkpzb25PYmplY3QgJiBSZWFsQnVpbGRlclByb2dyZXNzICYgVHlwZWRCdWlsZGVyUHJvZ3Jlc3M7XG5cbi8qKlxuICogQSBwcm9ncmVzcyByZXBvcnQgaXMgd2hhdCB0aGUgdG9vbGluZyB3aWxsIHJlY2VpdmUuIEl0IGNvbnRhaW5zIHRoZSBidWlsZGVyIGluZm8gYW5kIHRoZSB0YXJnZXQuXG4gKiBBbHRob3VnaCB0aGVzZSBhcmUgc2VyaWFsaXphYmxlLCB0aGV5IGFyZSBvbmx5IGV4cG9zZWQgdGhyb3VnaCB0aGUgdG9vbGluZyBpbnRlcmZhY2UsIG5vdCB0aGVcbiAqIGJ1aWxkZXIgaW50ZXJmYWNlLiBUaGUgd2F0Y2ggZG9nIHNlbmRzIEJ1aWxkZXJQcm9ncmVzcyBhbmQgdGhlIEJ1aWxkZXIgaGFzIGEgc2V0IG9mIGZ1bmN0aW9uc1xuICogdG8gbWFuYWdlIHRoZSBzdGF0ZS5cbiAqL1xuZXhwb3J0IHR5cGUgQnVpbGRlclByb2dyZXNzUmVwb3J0ID0gQnVpbGRlclByb2dyZXNzICYge1xuICB0YXJnZXQ/OiBUYXJnZXQ7XG4gIGJ1aWxkZXI6IEJ1aWxkZXJJbmZvO1xufTtcblxuLyoqXG4gKiBBIFJ1biwgd2hpY2ggaXMgd2hhdCBpcyByZXR1cm5lZCBieSBzY2hlZHVsZUJ1aWxkZXIgb3Igc2NoZWR1bGVUYXJnZXQgZnVuY3Rpb25zLiBUaGlzIHNob3VsZFxuICogYmUgcmVjb25zdHJ1Y3RlZCBhY3Jvc3MgbWVtb3J5IGJvdW5kYXJpZXMgKGl0J3Mgbm90IHNlcmlhbGl6YWJsZSBidXQgYWxsIGludGVybmFsIGluZm9ybWF0aW9uXG4gKiBhcmUpLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEJ1aWxkZXJSdW4ge1xuICAvKipcbiAgICogVW5pcXVlIGFtb25nc3QgcnVucy4gVGhpcyBpcyB0aGUgc2FtZSBJRCBhcyB0aGUgY29udGV4dCBnZW5lcmF0ZWQgZm9yIHRoZSBydW4uIEl0IGNhbiBiZVxuICAgKiB1c2VkIHRvIGlkZW50aWZ5IG11bHRpcGxlIHVuaXF1ZSBydW5zLiBUaGVyZSBpcyBubyBndWFyYW50ZWUgdGhhdCBhIHJ1biBpcyBhIHNpbmdsZSBvdXRwdXQ7XG4gICAqIGEgYnVpbGRlciBjYW4gcmVidWlsZCBvbiBpdHMgb3duIGFuZCB3aWxsIGdlbmVyYXRlIG11bHRpcGxlIG91dHB1dHMuXG4gICAqL1xuICBpZDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgYnVpbGRlciBpbmZvcm1hdGlvbi5cbiAgICovXG4gIGluZm86IEJ1aWxkZXJJbmZvO1xuXG4gIC8qKlxuICAgKiBUaGUgbmV4dCBvdXRwdXQgZnJvbSBhIGJ1aWxkZXIuIFRoaXMgaXMgcmVjb21tZW5kZWQgd2hlbiBzY2hlZHVsaW5nIGEgYnVpbGRlciBhbmQgb25seSBiZWluZ1xuICAgKiBpbnRlcmVzdGVkIGluIHRoZSByZXN1bHQgb2YgdGhhdCBzaW5nbGUgcnVuLCBub3Qgb2YgYSB3YXRjaC1tb2RlIGJ1aWxkZXIuXG4gICAqL1xuICByZXN1bHQ6IFByb21pc2U8QnVpbGRlck91dHB1dD47XG5cbiAgLyoqXG4gICAqIFRoZSBvdXRwdXQocykgZnJvbSB0aGUgYnVpbGRlci4gQSBidWlsZGVyIGNhbiBoYXZlIG11bHRpcGxlIG91dHB1dHMuXG4gICAqIFRoaXMgYWx3YXlzIHJlcGxheSB0aGUgbGFzdCBvdXRwdXQgd2hlbiBzdWJzY3JpYmVkLlxuICAgKi9cbiAgb3V0cHV0OiBPYnNlcnZhYmxlPEJ1aWxkZXJPdXRwdXQ+O1xuXG4gIC8qKlxuICAgKiBUaGUgcHJvZ3Jlc3MgcmVwb3J0LiBBIHByb2dyZXNzIGFsc28gY29udGFpbnMgYW4gSUQsIHdoaWNoIGNhbiBiZSBkaWZmZXJlbnQgdGhhbiB0aGlzIHJ1bidzXG4gICAqIElEIChpZiB0aGUgYnVpbGRlciBjYWxscyBzY2hlZHVsZUJ1aWxkZXIgb3Igc2NoZWR1bGVUYXJnZXQpLlxuICAgKiBUaGlzIHdpbGwgYWx3YXlzIHJlcGxheSB0aGUgbGFzdCBwcm9ncmVzcyBvbiBuZXcgc3Vic2NyaXB0aW9ucy5cbiAgICovXG4gIHByb2dyZXNzOiBPYnNlcnZhYmxlPEJ1aWxkZXJQcm9ncmVzc1JlcG9ydD47XG5cbiAgLyoqXG4gICAqIFN0b3AgdGhlIGJ1aWxkZXIgZnJvbSBydW5uaW5nLiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIGJ1aWxkZXIgaXMgc3RvcHBlZC5cbiAgICogU29tZSBidWlsZGVycyBtaWdodCBub3QgaGFuZGxlIHN0b3BwaW5nIHByb3Blcmx5IGFuZCBzaG91bGQgaGF2ZSBhIHRpbWVvdXQgaGVyZS5cbiAgICovXG4gIHN0b3AoKTogUHJvbWlzZTx2b2lkPjtcbn1cblxuLyoqXG4gKiBBZGRpdGlvbmFsIG9wdGlvbmFsIHNjaGVkdWxpbmcgb3B0aW9ucy5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTY2hlZHVsZU9wdGlvbnMge1xuICAvKipcbiAgICogTG9nZ2VyIHRvIHBhc3MgdG8gdGhlIGJ1aWxkZXIuIE5vdGUgdGhhdCBtZXNzYWdlcyB3aWxsIHN0b3AgYmVpbmcgZm9yd2FyZGVkLCBhbmQgaWYgeW91IHdhbnRcbiAgICogdG8gbG9nIGEgYnVpbGRlciBzY2hlZHVsZWQgZnJvbSB5b3VyIGJ1aWxkZXIgeW91IHNob3VsZCBmb3J3YXJkIGxvZyBldmVudHMgeW91cnNlbGYuXG4gICAqL1xuICBsb2dnZXI/OiBsb2dnaW5nLkxvZ2dlcjtcblxuICAvKipcbiAgICogVGFyZ2V0IHRvIHBhc3MgdG8gdGhlIGJ1aWxkZXIuXG4gICAqL1xuICB0YXJnZXQ/OiBUYXJnZXQ7XG59XG5cbi8qKlxuICogVGhlIGNvbnRleHQgcmVjZWl2ZWQgYXMgYSBzZWNvbmQgYXJndW1lbnQgaW4geW91ciBidWlsZGVyLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEJ1aWxkZXJDb250ZXh0IHtcbiAgLyoqXG4gICAqIFVuaXF1ZSBhbW9uZ3N0IGNvbnRleHRzLiBDb250ZXh0cyBpbnN0YW5jZXMgYXJlIG5vdCBndWFyYW50ZWVkIHRvIGJlIHRoZSBzYW1lIChidXQgaXQgY291bGRcbiAgICogYmUgdGhlIHNhbWUgY29udGV4dCksIGFuZCBhbGwgdGhlIGZpZWxkcyBpbiBhIGNvbnRleHQgY291bGQgYmUgdGhlIHNhbWUsIHlldCB0aGUgYnVpbGRlcidzXG4gICAqIGNvbnRleHQgY291bGQgYmUgZGlmZmVyZW50LiBUaGlzIGlzIHRoZSBzYW1lIElEIGFzIHRoZSBjb3JyZXNwb25kaW5nIHJ1bi5cbiAgICovXG4gIGlkOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIFRoZSBidWlsZGVyIGluZm8gdGhhdCBjYWxsZWQgeW91ciBmdW5jdGlvbi4gU2luY2UgdGhlIGJ1aWxkZXIgaW5mbyBpcyBmcm9tIHRoZSBidWlsZGVyLmpzb25cbiAgICogKG9yIHRoZSBob3N0KSwgaXQgY291bGQgY29udGFpbiBpbmZvcm1hdGlvbiB0aGF0IGlzIGRpZmZlcmVudCB0aGFuIGV4cGVjdGVkLlxuICAgKi9cbiAgYnVpbGRlcjogQnVpbGRlckluZm87XG5cbiAgLyoqXG4gICAqIEEgbG9nZ2VyIHRoYXQgYXBwZW5kcyBtZXNzYWdlcyB0byBhIGxvZy4gVGhpcyBjb3VsZCBiZSBhIHNlcGFyYXRlIGludGVyZmFjZSBvciBjb21wbGV0ZWx5XG4gICAqIGlnbm9yZWQuIGBjb25zb2xlLmxvZ2AgY291bGQgYWxzbyBiZSBjb21wbGV0ZWx5IGlnbm9yZWQuXG4gICAqL1xuICBsb2dnZXI6IGxvZ2dpbmcuTG9nZ2VyQXBpO1xuXG4gIC8qKlxuICAgKiBUaGUgYWJzb2x1dGUgd29ya3NwYWNlIHJvb3Qgb2YgdGhpcyBydW4uIFRoaXMgaXMgYSBzeXN0ZW0gcGF0aCBhbmQgd2lsbCBub3QgYmUgbm9ybWFsaXplZDtcbiAgICogaWUuIG9uIFdpbmRvd3MgaXQgd2lsbCBzdGFydHMgd2l0aCBgQzpcXFxcYCAob3Igd2hhdGV2ZXIgZHJpdmUpLlxuICAgKi9cbiAgd29ya3NwYWNlUm9vdDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgY3VycmVudCBkaXJlY3RvcnkgdGhlIHVzZXIgaXMgaW4uIFRoaXMgY291bGQgYmUgb3V0c2lkZSB0aGUgd29ya3NwYWNlIHJvb3QuIFRoaXMgaXMgYVxuICAgKiBzeXN0ZW0gcGF0aCBhbmQgd2lsbCBub3QgYmUgbm9ybWFsaXplZDsgaWUuIG9uIFdpbmRvd3MgaXQgd2lsbCBzdGFydHMgd2l0aCBgQzpcXFxcYCAob3JcbiAgICogd2hhdGV2ZXIgZHJpdmUpLlxuICAgKi9cbiAgY3VycmVudERpcmVjdG9yeTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgdGFyZ2V0IHRoYXQgd2FzIHVzZWQgdG8gcnVuIHRoaXMgYnVpbGRlci5cbiAgICogVGFyZ2V0IGlzIG9wdGlvbmFsIGlmIGEgYnVpbGRlciB3YXMgcmFuIHVzaW5nIGBzY2hlZHVsZUJ1aWxkZXIoKWAuXG4gICAqL1xuICB0YXJnZXQ/OiBUYXJnZXQ7XG5cbiAgLyoqXG4gICAqIFNjaGVkdWxlIGEgdGFyZ2V0IGluIHRoZSBzYW1lIHdvcmtzcGFjZS4gVGhpcyBjYW4gYmUgdGhlIHNhbWUgdGFyZ2V0IHRoYXQgaXMgYmVpbmcgZXhlY3V0ZWRcbiAgICogcmlnaHQgbm93LCBidXQgdGFyZ2V0cyBvZiB0aGUgc2FtZSBuYW1lIGFyZSBzZXJpYWxpemVkLlxuICAgKiBSdW5uaW5nIHRoZSBzYW1lIHRhcmdldCBhbmQgd2FpdGluZyBmb3IgaXQgdG8gZW5kIHdpbGwgcmVzdWx0IGluIGEgZGVhZGxvY2tpbmcgc2NlbmFyaW8uXG4gICAqIFRhcmdldHMgYXJlIGNvbnNpZGVyZWQgdGhlIHNhbWUgaWYgdGhlIHByb2plY3QsIHRoZSB0YXJnZXQgQU5EIHRoZSBjb25maWd1cmF0aW9uIGFyZSB0aGUgc2FtZS5cbiAgICogQHBhcmFtIHRhcmdldCBUaGUgdGFyZ2V0IHRvIHNjaGVkdWxlLlxuICAgKiBAcGFyYW0gb3ZlcnJpZGVzIEEgc2V0IG9mIG9wdGlvbnMgdG8gb3ZlcnJpZGUgdGhlIHdvcmtzcGFjZSBzZXQgb2Ygb3B0aW9ucy5cbiAgICogQHBhcmFtIHNjaGVkdWxlT3B0aW9ucyBBZGRpdGlvbmFsIG9wdGlvbmFsIHNjaGVkdWxpbmcgb3B0aW9ucy5cbiAgICogQHJldHVybiBBIHByb21pc2Ugb2YgYSBydW4uIEl0IHdpbGwgcmVzb2x2ZSB3aGVuIGFsbCB0aGUgbWVtYmVycyBvZiB0aGUgcnVuIGFyZSBhdmFpbGFibGUuXG4gICAqL1xuICBzY2hlZHVsZVRhcmdldChcbiAgICB0YXJnZXQ6IFRhcmdldCxcbiAgICBvdmVycmlkZXM/OiBqc29uLkpzb25PYmplY3QsXG4gICAgc2NoZWR1bGVPcHRpb25zPzogU2NoZWR1bGVPcHRpb25zLFxuICApOiBQcm9taXNlPEJ1aWxkZXJSdW4+O1xuXG4gIC8qKlxuICAgKiBTY2hlZHVsZSBhIGJ1aWxkZXIgYnkgaXRzIG5hbWUuIFRoaXMgY2FuIGJlIHRoZSBzYW1lIGJ1aWxkZXIgdGhhdCBpcyBiZWluZyBleGVjdXRlZC5cbiAgICogQHBhcmFtIGJ1aWxkZXJOYW1lIFRoZSBuYW1lIG9mIHRoZSBidWlsZGVyLCBpZS4gaXRzIGBwYWNrYWdlTmFtZTpidWlsZGVyTmFtZWAgdHVwbGUuXG4gICAqIEBwYXJhbSBvcHRpb25zIEFsbCBvcHRpb25zIHRvIHVzZSBmb3IgdGhlIGJ1aWxkZXIgKGJ5IGRlZmF1bHQgZW1wdHkgb2JqZWN0KS4gVGhlcmUgaXMgbm9cbiAgICogICAgIGFkZGl0aW9uYWwgb3B0aW9ucyBhZGRlZCwgZS5nLiBmcm9tIHRoZSB3b3Jrc3BhY2UuXG4gICAqIEBwYXJhbSBzY2hlZHVsZU9wdGlvbnMgQWRkaXRpb25hbCBvcHRpb25hbCBzY2hlZHVsaW5nIG9wdGlvbnMuXG4gICAqIEByZXR1cm4gQSBwcm9taXNlIG9mIGEgcnVuLiBJdCB3aWxsIHJlc29sdmUgd2hlbiBhbGwgdGhlIG1lbWJlcnMgb2YgdGhlIHJ1biBhcmUgYXZhaWxhYmxlLlxuICAgKi9cbiAgc2NoZWR1bGVCdWlsZGVyKFxuICAgIGJ1aWxkZXJOYW1lOiBzdHJpbmcsXG4gICAgb3B0aW9ucz86IGpzb24uSnNvbk9iamVjdCxcbiAgICBzY2hlZHVsZU9wdGlvbnM/OiBTY2hlZHVsZU9wdGlvbnMsXG4gICk6IFByb21pc2U8QnVpbGRlclJ1bj47XG5cbiAgLyoqXG4gICAqIFJlc29sdmUgYW5kIHJldHVybiBvcHRpb25zIGZvciBhIHNwZWNpZmllZCB0YXJnZXQuIElmIHRoZSB0YXJnZXQgaXNuJ3QgZGVmaW5lZCBpbiB0aGVcbiAgICogd29ya3NwYWNlIHRoaXMgd2lsbCByZWplY3QgdGhlIHByb21pc2UuIFRoaXMgb2JqZWN0IHdpbGwgYmUgcmVhZCBkaXJlY3RseSBmcm9tIHRoZSB3b3Jrc3BhY2VcbiAgICogYnV0IG5vdCB2YWxpZGF0ZWQgYWdhaW5zdCB0aGUgYnVpbGRlciBvZiB0aGUgdGFyZ2V0LlxuICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdG8gcmVzb2x2ZSB0aGUgb3B0aW9ucyBvZi5cbiAgICogQHJldHVybiBBIG5vbi12YWxpZGF0ZWQgb2JqZWN0IHJlc29sdmVkIGZyb20gdGhlIHdvcmtzcGFjZS5cbiAgICovXG4gIGdldFRhcmdldE9wdGlvbnModGFyZ2V0OiBUYXJnZXQpOiBQcm9taXNlPGpzb24uSnNvbk9iamVjdD47XG5cbiAgZ2V0UHJvamVjdE1ldGFkYXRhKHByb2plY3ROYW1lOiBzdHJpbmcpOiBQcm9taXNlPGpzb24uSnNvbk9iamVjdD47XG4gIGdldFByb2plY3RNZXRhZGF0YSh0YXJnZXQ6IFRhcmdldCk6IFByb21pc2U8anNvbi5Kc29uT2JqZWN0PjtcblxuICAvKipcbiAgICogUmVzb2x2ZXMgYW5kIHJldHVybiBhIGJ1aWxkZXIgbmFtZS4gVGhlIGV4YWN0IGZvcm1hdCBvZiB0aGUgbmFtZSBpcyB1cCB0byB0aGUgaG9zdCxcbiAgICogc28gaXQgc2hvdWxkIG5vdCBiZSBwYXJzZWQgdG8gZ2F0aGVyIGluZm9ybWF0aW9uIChpdCdzIGZyZWUgZm9ybSkuIFRoaXMgc3RyaW5nIGNhbiBiZVxuICAgKiB1c2VkIHRvIHZhbGlkYXRlIG9wdGlvbnMgb3Igc2NoZWR1bGUgYSBidWlsZGVyIGRpcmVjdGx5LlxuICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdG8gcmVzb2x2ZSB0aGUgYnVpbGRlciBuYW1lLlxuICAgKi9cbiAgZ2V0QnVpbGRlck5hbWVGb3JUYXJnZXQodGFyZ2V0OiBUYXJnZXQpOiBQcm9taXNlPHN0cmluZz47XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlcyB0aGUgb3B0aW9ucyBhZ2FpbnN0IGEgYnVpbGRlciBzY2hlbWEuIFRoaXMgdXNlcyB0aGUgc2FtZSBtZXRob2RzIGFzIHRoZVxuICAgKiBzY2hlZHVsZVRhcmdldCBhbmQgc2NoZWR1bGVCcm93c2VyIG1ldGhvZHMgdG8gdmFsaWRhdGUgYW5kIGFwcGx5IGRlZmF1bHRzIHRvIHRoZSBvcHRpb25zLlxuICAgKiBJdCBjYW4gYmUgZ2VuZXJpY2FsbHkgdHlwZWQsIGlmIHlvdSBrbm93IHdoaWNoIGludGVyZmFjZSBpdCBpcyBzdXBwb3NlZCB0byB2YWxpZGF0ZSBhZ2FpbnN0LlxuICAgKiBAcGFyYW0gb3B0aW9ucyBBIGdlbmVyaWMgb3B0aW9uIG9iamVjdCB0byB2YWxpZGF0ZS5cbiAgICogQHBhcmFtIGJ1aWxkZXJOYW1lIFRoZSBuYW1lIG9mIGEgYnVpbGRlciB0byB1c2UuIFRoaXMgY2FuIGJlIGdvdHRlbiBmb3IgYSB0YXJnZXQgYnkgdXNpbmcgdGhlXG4gICAqICAgICAgICAgICAgICAgICAgICBnZXRCdWlsZGVyRm9yVGFyZ2V0KCkgbWV0aG9kIG9uIHRoZSBjb250ZXh0LlxuICAgKi9cbiAgdmFsaWRhdGVPcHRpb25zPFQgZXh0ZW5kcyBqc29uLkpzb25PYmplY3QgPSBqc29uLkpzb25PYmplY3Q+KFxuICAgIG9wdGlvbnM6IGpzb24uSnNvbk9iamVjdCxcbiAgICBidWlsZGVyTmFtZTogc3RyaW5nLFxuICApOiBQcm9taXNlPFQ+O1xuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGJ1aWxkZXIgdG8gcnVubmluZy4gVGhpcyBzaG91bGQgYmUgdXNlZCBpZiBhbiBleHRlcm5hbCBldmVudCB0cmlnZ2VyZWQgYSByZS1ydW4sXG4gICAqIGUuZy4gYSBmaWxlIHdhdGNoZWQgd2FzIGNoYW5nZWQuXG4gICAqL1xuICByZXBvcnRSdW5uaW5nKCk6IHZvaWQ7XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgc3RhdHVzIHN0cmluZyBzaG93biBvbiB0aGUgaW50ZXJmYWNlLlxuICAgKiBAcGFyYW0gc3RhdHVzIFRoZSBzdGF0dXMgdG8gc2V0IGl0IHRvLiBBbiBlbXB0eSBzdHJpbmcgY2FuIGJlIHVzZWQgdG8gcmVtb3ZlIHRoZSBzdGF0dXMuXG4gICAqL1xuICByZXBvcnRTdGF0dXMoc3RhdHVzOiBzdHJpbmcpOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHByb2dyZXNzIGZvciB0aGlzIGJ1aWxkZXIgcnVuLlxuICAgKiBAcGFyYW0gY3VycmVudCBUaGUgY3VycmVudCBwcm9ncmVzcy4gVGhpcyB3aWxsIGJlIGJldHdlZW4gMCBhbmQgdG90YWwuXG4gICAqIEBwYXJhbSB0b3RhbCBBIG5ldyB0b3RhbCB0byBzZXQuIEJ5IGRlZmF1bHQgYXQgdGhlIHN0YXJ0IG9mIGEgcnVuIHRoaXMgaXMgMS4gSWYgb21pdHRlZCBpdFxuICAgKiAgICAgd2lsbCB1c2UgdGhlIHNhbWUgdmFsdWUgYXMgdGhlIGxhc3QgdG90YWwuXG4gICAqIEBwYXJhbSBzdGF0dXMgVXBkYXRlIHRoZSBzdGF0dXMgc3RyaW5nLiBJZiBvbWl0dGVkIHRoZSBzdGF0dXMgc3RyaW5nIGlzIG5vdCBtb2RpZmllZC5cbiAgICovXG4gIHJlcG9ydFByb2dyZXNzKGN1cnJlbnQ6IG51bWJlciwgdG90YWw/OiBudW1iZXIsIHN0YXR1cz86IHN0cmluZyk6IHZvaWQ7XG5cbiAgLyoqXG4gICAqIEFQSSB0byByZXBvcnQgYW5hbHl0aWNzLiBUaGlzIG1pZ2h0IGJlIHVuZGVmaW5lZCBpZiB0aGUgZmVhdHVyZSBpcyB1bnN1cHBvcnRlZC4gVGhpcyBtaWdodFxuICAgKiBub3QgYmUgdW5kZWZpbmVkLCBidXQgdGhlIGJhY2tlbmQgY291bGQgYWxzbyBub3QgcmVwb3J0IGFueXRoaW5nLlxuICAgKi9cbiAgcmVhZG9ubHkgYW5hbHl0aWNzOiBhbmFseXRpY3MuQW5hbHl0aWNzO1xuXG4gIC8qKlxuICAgKiBBZGQgdGVhcmRvd24gbG9naWMgdG8gdGhpcyBDb250ZXh0LCBzbyB0aGF0IHdoZW4gaXQncyBiZWluZyBzdG9wcGVkIGl0IHdpbGwgZXhlY3V0ZSB0ZWFyZG93bi5cbiAgICovXG4gIGFkZFRlYXJkb3duKHRlYXJkb3duOiAoKSA9PiBQcm9taXNlPHZvaWQ+IHwgdm9pZCk6IHZvaWQ7XG59XG5cbi8qKlxuICogQW4gYWNjZXB0ZWQgcmV0dXJuIHZhbHVlIGZyb20gYSBidWlsZGVyLiBDYW4gYmUgZWl0aGVyIGFuIE9ic2VydmFibGUsIGEgUHJvbWlzZSBvciBhIHZlY3Rvci5cbiAqL1xuZXhwb3J0IHR5cGUgQnVpbGRlck91dHB1dExpa2UgPVxuICB8IEFzeW5jSXRlcmFibGU8QnVpbGRlck91dHB1dD5cbiAgfCBTdWJzY3JpYmFibGVPclByb21pc2U8QnVpbGRlck91dHB1dD5cbiAgfCBCdWlsZGVyT3V0cHV0O1xuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuZXhwb3J0IGZ1bmN0aW9uIGlzQnVpbGRlck91dHB1dChvYmo6IGFueSk6IG9iaiBpcyBCdWlsZGVyT3V0cHV0IHtcbiAgaWYgKCFvYmogfHwgdHlwZW9mIG9iai50aGVuID09PSAnZnVuY3Rpb24nIHx8IHR5cGVvZiBvYmouc3Vic2NyaWJlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBvYmpbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHR5cGVvZiBvYmouc3VjY2VzcyA9PT0gJ2Jvb2xlYW4nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZnJvbUFzeW5jSXRlcmFibGU8VD4oaXRlcmFibGU6IEFzeW5jSXRlcmFibGU8VD4pOiBPYnNlcnZhYmxlPFQ+IHtcbiAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKChzdWJzY3JpYmVyKSA9PiB7XG4gICAgaGFuZGxlQXN5bmNJdGVyYXRvcihzdWJzY3JpYmVyLCBpdGVyYWJsZVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSkudGhlbihcbiAgICAgICgpID0+IHN1YnNjcmliZXIuY29tcGxldGUoKSxcbiAgICAgIChlcnJvcikgPT4gc3Vic2NyaWJlci5lcnJvcihlcnJvciksXG4gICAgKTtcbiAgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUFzeW5jSXRlcmF0b3I8VD4oXG4gIHN1YnNjcmliZXI6IFN1YnNjcmliZXI8VD4sXG4gIGl0ZXJhdG9yOiBBc3luY0l0ZXJhdG9yPFQ+LFxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHRlYXJkb3duID0gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUpID0+IHN1YnNjcmliZXIuYWRkKCgpID0+IHJlc29sdmUoKSkpO1xuXG4gIHRyeSB7XG4gICAgd2hpbGUgKCFzdWJzY3JpYmVyLmNsb3NlZCkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUHJvbWlzZS5yYWNlKFt0ZWFyZG93biwgaXRlcmF0b3IubmV4dCgpXSk7XG4gICAgICBpZiAoIXJlc3VsdCB8fCByZXN1bHQuZG9uZSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgc3Vic2NyaWJlci5uZXh0KHJlc3VsdC52YWx1ZSk7XG4gICAgfVxuICB9IGZpbmFsbHkge1xuICAgIGF3YWl0IGl0ZXJhdG9yLnJldHVybj8uKCk7XG4gIH1cbn1cblxuLyoqXG4gKiBBIGJ1aWxkZXIgaGFuZGxlciBmdW5jdGlvbi4gVGhlIGZ1bmN0aW9uIHNpZ25hdHVyZSBwYXNzZWQgdG8gYGNyZWF0ZUJ1aWxkZXIoKWAuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQnVpbGRlckhhbmRsZXJGbjxBPiB7XG4gIC8qKlxuICAgKiBCdWlsZGVycyBhcmUgZGVmaW5lZCBieSB1c2VycyB0byBwZXJmb3JtIGFueSBraW5kIG9mIHRhc2ssIGxpa2UgYnVpbGRpbmcsIHRlc3Rpbmcgb3IgbGludGluZyxcbiAgICogYW5kIHNob3VsZCB1c2UgdGhpcyBpbnRlcmZhY2UuXG4gICAqIEBwYXJhbSBpbnB1dCBUaGUgb3B0aW9ucyAoYSBKc29uT2JqZWN0KSwgdmFsaWRhdGVkIGJ5IHRoZSBzY2hlbWEgYW5kIHJlY2VpdmVkIGJ5IHRoZVxuICAgKiAgICAgYnVpbGRlci4gVGhpcyBjYW4gaW5jbHVkZSByZXNvbHZlZCBvcHRpb25zIGZyb20gdGhlIENMSSBvciB0aGUgd29ya3NwYWNlLlxuICAgKiBAcGFyYW0gY29udGV4dCBBIGNvbnRleHQgdGhhdCBjYW4gYmUgdXNlZCB0byBpbnRlcmFjdCB3aXRoIHRoZSBBcmNoaXRlY3QgZnJhbWV3b3JrLlxuICAgKiBAcmV0dXJuIE9uZSBvciBtYW55IGJ1aWxkZXIgb3V0cHV0LlxuICAgKi9cbiAgKGlucHV0OiBBLCBjb250ZXh0OiBCdWlsZGVyQ29udGV4dCk6IEJ1aWxkZXJPdXRwdXRMaWtlO1xufVxuXG4vKipcbiAqIEEgQnVpbGRlciBnZW5lcmFsIGluZm9ybWF0aW9uLiBUaGlzIGlzIGdlbmVyYXRlZCBieSB0aGUgaG9zdCBhbmQgaXMgZXhwYW5kZWQgYnkgdGhlIGhvc3QsIGJ1dFxuICogdGhlIHB1YmxpYyBBUEkgY29udGFpbnMgdGhvc2UgZmllbGRzLlxuICovXG5leHBvcnQgdHlwZSBCdWlsZGVySW5mbyA9IGpzb24uSnNvbk9iamVjdCAmIHtcbiAgYnVpbGRlck5hbWU6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgb3B0aW9uU2NoZW1hOiBqc29uLnNjaGVtYS5Kc29uU2NoZW1hO1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIGEgc3RyaW5nIG9mIFwicHJvamVjdDp0YXJnZXRbOmNvbmZpZ3VyYXRpb25dXCIgZm9yIHRoZSB0YXJnZXQgb2JqZWN0LlxuICovXG5leHBvcnQgZnVuY3Rpb24gdGFyZ2V0U3RyaW5nRnJvbVRhcmdldCh7IHByb2plY3QsIHRhcmdldCwgY29uZmlndXJhdGlvbiB9OiBUYXJnZXQpIHtcbiAgcmV0dXJuIGAke3Byb2plY3R9OiR7dGFyZ2V0fSR7Y29uZmlndXJhdGlvbiAhPT0gdW5kZWZpbmVkID8gJzonICsgY29uZmlndXJhdGlvbiA6ICcnfWA7XG59XG5cbi8qKlxuICogUmV0dXJuIGEgVGFyZ2V0IHR1cGxlIGZyb20gYSBzdHJpbmcuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0YXJnZXRGcm9tVGFyZ2V0U3RyaW5nKHN0cjogc3RyaW5nKTogVGFyZ2V0IHtcbiAgY29uc3QgdHVwbGUgPSBzdHIuc3BsaXQoLzovLCAzKTtcbiAgaWYgKHR1cGxlLmxlbmd0aCA8IDIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgdGFyZ2V0IHN0cmluZzogJyArIEpTT04uc3RyaW5naWZ5KHN0cikpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBwcm9qZWN0OiB0dXBsZVswXSxcbiAgICB0YXJnZXQ6IHR1cGxlWzFdLFxuICAgIC4uLih0dXBsZVsyXSAhPT0gdW5kZWZpbmVkICYmIHsgY29uZmlndXJhdGlvbjogdHVwbGVbMl0gfSksXG4gIH07XG59XG5cbi8qKlxuICogU2NoZWR1bGUgYSB0YXJnZXQsIGFuZCBmb3JnZXQgYWJvdXQgaXRzIHJ1bi4gVGhpcyB3aWxsIHJldHVybiBhbiBvYnNlcnZhYmxlIG9mIG91dHB1dHMsIHRoYXRcbiAqIGFzIGEgYSB0ZWFyZG93biB3aWxsIHN0b3AgdGhlIHRhcmdldCBmcm9tIHJ1bm5pbmcuIFRoaXMgbWVhbnMgdGhhdCB0aGUgUnVuIG9iamVjdCB0aGlzIHJldHVybnNcbiAqIHNob3VsZCBub3QgYmUgc2hhcmVkLlxuICpcbiAqIFRoZSByZWFzb24gdGhpcyBpcyBub3QgcGFydCBvZiB0aGUgQ29udGV4dCBpbnRlcmZhY2UgaXMgdG8ga2VlcCB0aGUgQ29udGV4dCBhcyBub3JtYWwgZm9ybSBhc1xuICogcG9zc2libGUuIFRoaXMgaXMgcmVhbGx5IGFuIHV0aWxpdHkgdGhhdCBwZW9wbGUgd291bGQgaW1wbGVtZW50IGluIHRoZWlyIHByb2plY3QuXG4gKlxuICogQHBhcmFtIGNvbnRleHQgVGhlIGNvbnRleHQgb2YgeW91ciBjdXJyZW50IGV4ZWN1dGlvbi5cbiAqIEBwYXJhbSB0YXJnZXQgVGhlIHRhcmdldCB0byBzY2hlZHVsZS5cbiAqIEBwYXJhbSBvdmVycmlkZXMgT3ZlcnJpZGVzIHRoYXQgYXJlIHVzZWQgaW4gdGhlIHRhcmdldC5cbiAqIEBwYXJhbSBzY2hlZHVsZU9wdGlvbnMgQWRkaXRpb25hbCBzY2hlZHVsaW5nIG9wdGlvbnMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzY2hlZHVsZVRhcmdldEFuZEZvcmdldChcbiAgY29udGV4dDogQnVpbGRlckNvbnRleHQsXG4gIHRhcmdldDogVGFyZ2V0LFxuICBvdmVycmlkZXM/OiBqc29uLkpzb25PYmplY3QsXG4gIHNjaGVkdWxlT3B0aW9ucz86IFNjaGVkdWxlT3B0aW9ucyxcbik6IE9ic2VydmFibGU8QnVpbGRlck91dHB1dD4ge1xuICBsZXQgcmVzb2x2ZTogKCgpID0+IHZvaWQpIHwgbnVsbCA9IG51bGw7XG4gIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZTx2b2lkPigocikgPT4gKHJlc29sdmUgPSByKSk7XG4gIGNvbnRleHQuYWRkVGVhcmRvd24oKCkgPT4gcHJvbWlzZSk7XG5cbiAgcmV0dXJuIGZyb20oY29udGV4dC5zY2hlZHVsZVRhcmdldCh0YXJnZXQsIG92ZXJyaWRlcywgc2NoZWR1bGVPcHRpb25zKSkucGlwZShcbiAgICBzd2l0Y2hNYXAoXG4gICAgICAocnVuKSA9PlxuICAgICAgICBuZXcgT2JzZXJ2YWJsZTxCdWlsZGVyT3V0cHV0Pigob2JzZXJ2ZXIpID0+IHtcbiAgICAgICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSBydW4ub3V0cHV0LnN1YnNjcmliZShvYnNlcnZlcik7XG5cbiAgICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAvLyBXZSBjYW4gcHJvcGVybHkgaWdub3JlIHRoZSBmbG9hdGluZyBwcm9taXNlIGFzIGl0J3MgYSBcInJldmVyc2VcIiBwcm9taXNlOyB0aGUgdGVhcmRvd25cbiAgICAgICAgICAgIC8vIGlzIHdhaXRpbmcgZm9yIHRoZSByZXNvbHZlLlxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xuICAgICAgICAgICAgcnVuLnN0b3AoKS50aGVuKHJlc29sdmUpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pLFxuICAgICksXG4gICk7XG59XG4iXX0=